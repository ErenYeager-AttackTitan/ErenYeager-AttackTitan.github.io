I"2<h1 style="text-align: center;">بسم الله الرحمن الرحيم</h1>

<p>Setelah sebelumnya melakukan perancangan arsitektur kafka, pada dokumentasi ini akan melakukan pembuatan langsung atau praktik dari arsitektur yang telah dibuat. Langkah awal adalah melakukan pembuatan topic dimana topicnya terdiri dari daftar_bank, debit, kredit dan transaksi. pertama kita melakukan pembuatan topic dengan nama <code class="language-plaintext highlighter-rouge">daftar_bank</code>, <code class="language-plaintext highlighter-rouge">kredit</code> dan <code class="language-plaintext highlighter-rouge">debit</code>.</p>

<p><img title="Pembuatan Topic" alt="" src="/img/posts/Juni/11_2/gambar1.png" /></p>

<p>Selanjutnya adalah melakukan pembuatan program java, pembuatan program meliputi :</p>
<ol>
  <li>
    <p><em>FileProducer</em>, untuk melakukan streaming dari file, yang akan mengirimkan pesan sesuai dengan topic dari jenis pesan yang telah ditentukan.</p>
  </li>
  <li>
    <p><em>FileConsumer</em>, aplikasi consumer dengan java yang akan menerima pesan dari topic.</p>
  </li>
  <li>
    <p><em>PostProducer</em>, adalah sebuah program yang akan mengirimkan pesan melaui HTTP Method Post ke topic transaksi</p>
  </li>
  <li>
    <p><em>PostConsumer</em>, yang terakhir adalah melakukan pengelompokan message sesuai dengan type pesan yang dibawa.</p>
  </li>
</ol>

<h2 id="1-penginstalan-dependensi-centos-7">1. Penginstalan Dependensi (CentOS 7)</h2>

<p>Agar mempermudah membangun sebuah program maka dibutuhkan tools yang mendukung, tools yang dibutuhkan antara lain adalah Java Development Kit atau JDK dimana versi yang digunakan adalah JDK 18 dan Maven. Apache Maven adalah Java Build Tools yang menggunakan konsep Project Object Model (POM). POM tersebut berisi informasi dan konfigurasi yang digunakan Maven untuk membuat project.</p>

<p><strong>1. Penginstalan JDK 18</strong></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>wget https://download.oracle.com/java/18/latest/jdk-18_linux-x64_bin.rpm
 <span class="nv">$ </span><span class="nb">sudo </span>rpm <span class="nt">-Uvh</span> jdk-18_linux-x64_bin.rpm 
</code></pre></div></div>
<p><strong>2. Konfigurasi JDK 18 Environment</strong></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> | sudo tee /etc/profile.d/jdk18.sh
		export JAVA_HOME=/usr/java/default
		export PATH=</span><span class="se">\$</span><span class="sh">PATH:</span><span class="se">\$</span><span class="sh">JAVA_HOME/bin EOF
  </span><span class="nv">$ </span><span class="sh">source /etc/profile.d/jdk18.sh
  </span><span class="nv">$ </span><span class="sh">java -version
</span></code></pre></div></div>
<p><img title="Cek Versi Java" alt="" src="/img/posts/Juni/11_2/gambar2.png" /></p>

<p><strong>3. Penginstalan Maven</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ wget https://dlcdn.apache.org/maven/maven-3/3.8.5/binaries/apache-maven-3.8.5-bin.tar.gz
$ tar -zvf  apache-maven-3.8.5-bin.tar.gz
</code></pre></div></div>
<p><strong>4. Konfigurasi maven environment</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ vim ~/.bashrc
	(Tambahkan Maven_HOME lalu exit)
	$ source ~/.bashrc
</code></pre></div></div>

<p><img title=" export maven home" alt="" src="/img/posts/Juni/11_2/gambar3.png" /></p>

<h2 id="2-program-fileproducer">2. Program FileProducer</h2>

<p>berikut merupakan contoh dari isi file example.txt</p>

<p><img title="data dummy example.txt" alt="" src="/img/posts/Juni/11_2/gambar4.png" /></p>

<p>Saat melakukan File Producer, dibutuhkan konfigurasi dari untuk menghubungkan koneksi kesetiap broker.</p>

<p><img title="properties program File Producer" alt="" src="/img/posts/Juni/11_2/gambar5.png" /></p>

<p>Properties ini dibuat agar memudahkan pengaturan konfigurasi pada program. Selanjutnya pada kode program akan melakukan path terhadap properties. Berikut beberapa penjelasan perintah yang dilakukan.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JSONObject topics = new JSONObject((String) props.get("list.topic"));
</code></pre></div></div>
<p>perintah ini akan membaca “list.topic” topic yang terdapat dalam properties dimana list berupa JSON dan key “type” (string).</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);
</code></pre></div></div>

<p>ini merupakan Init dari koneksi kafka</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FileReader fileReader = new FileReader((String) props.get("file.path"));
BufferedReader bufReader = new BufferedReader(fileReader);
</code></pre></div></div>

<p>Perintah ini akan mengambil lokasi dari path File Producer yang telah di inisialisasi pada properties sebelumnya.</p>

<p>Selanjutnya akan dilakukan perulanan untuk seriap baris dari file yang sedang dibaca oleh program. Program akan memuat (payload) isi file setiap barisnya dengan kondisi :</p>

<ol>
  <li>
    <p>Jika program membaca pesan  sesuai dengan type tehadap topic yang sudah diinisialisasi pada properties maka program akan mengirimkan pesan sesuai topic.</p>
  </li>
  <li>
    <p>Jika Program membaca pesan, namun tidak ada pesan yang memiliki type yang sesuai maka program akan mengirimkan perintah error “tidak ada topic yang relevan”</p>
  </li>
  <li>
    <p>Jika dalam baris file terdapat baris yang kosong makan program akan menunggu selama 5 detik sampai ada baris berikutnya</p>
  </li>
  <li>
    <p>file log akan tersimpan dalam folder ./log/ denagn nama tes.log</p>
  </li>
</ol>

<p>setelah melakukan pengkodean, dengan menggunakan IDE selanjutnya adalah proses deploy program ke server. Kode ini dibuil dengan menggunakan maven dengan dependensi :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>• flink-java
• kafka-clients
• json
• log4j
</code></pre></div></div>

<p>dengan mengirimkan source kode ke server dan melakukan build</p>

<p><code class="language-plaintext highlighter-rouge">$ mvn clean compile</code></p>

<p>dari perintah ini akan menghasilkan file jar <code class="language-plaintext highlighter-rouge">producer.jar</code> Setelah melakukan Build selanjutnya adalah pengetesan program pada server.</p>

<p><img title="Log File program FileProducer" alt="" src="/img/posts/Juni/11_2/gambar6.png" /></p>

<h2 id="3-program-fileconsumer">3. Program FileConsumer</h2>
<p>Pada program ini menggunakan spring boot untuk mengirimkan pesan dari topic kepada APP. Langkah pertapa yang dilakukan adalah melakukan generate depedensi pada website <a href="https://start.spring.io/">https://start.spring.io/</a> dengan menggunakan spring boor versin 2.7, JDK 18 dan di build dengan Maven. Sementara depensi yang perlukan antara lain Spring Boot Dev Tools, Spring for Apache Kafka dan cloud stream.</p>

<p><img title="Interface Spring initializr" alt="" src="/img/posts/Juni/11_2/gambar7.png" /></p>

<p>selanjutnya melakukan pengkodean dari paket project yang telah digenerate. Pada program ini akan dibuat beberapa Package, diantaranya ialah :</p>
<ol>
  <li><strong>Config</strong> : berisi java.java dengan nama KafkaConfiguration yang berisi konfigurasi dari kafka broker dan consumer config mewakili setiap topic yang akan menerima pesan (consume)</li>
  <li><strong>Listener</strong> : berisi java.java KafkaConsumer yang berisi program <code class="language-plaintext highlighter-rouge">@Servis</code> dan <code class="language-plaintext highlighter-rouge">@KafkaListener</code> yang akan membuat pesan yang diterima berdasarkan package config</li>
  <li><strong>model</strong> : berisi class-class java yang akan menginisialisasi type pesan setiap topic terdiri dari DaftarBank, Debit, Kredit yang mewakili setiap topic dan berisi inisialisasi dari type pesan yang di bawa oleh topic</li>
</ol>

<p>Pada Package  dilakukan inisialisasi serta pembuatan setter, getter dan container dari setiap class.</p>

<p><img title="Debit.java pada package Config" alt="" src="/img/posts/Juni/11_2/gambar8.png" /></p>

<p>ini akan melakukan inisialisasi dari pesan yang akan diterima dari topic. pada Package Config dilakukan perintah :</p>

<p><img title="KafkaConfiguration.java" alt="" src="/img/posts/Juni/11_2/gambar9.png" /></p>

<p>dengan menggunakan ConsumerFactory yang akan menginisialisasi key dan value dari kafka consumer dimana  akan memanggil class dari package model ututk setiap class yang mewakili topic, padda gambar 9 melakukan ConsumerFactory terhadap class Debit. Dengan memanggil Consumer.Config untuk menginisialisasi Bootstap-Server, Group_ID, key dan Value. Dilakukan hal yang sama pada class class lainnya</p>

<p>Selanjutnya  package  listener pada KafkaConsumer.java akan melakukan <code class="language-plaintext highlighter-rouge">@service</code> dengan menjadikan <code class="language-plaintext highlighter-rouge">@KafkaListener</code> pada setiap topic sehingga menungkinkan menerima pesan.</p>

<p><img title="KafkaConsumer.java" alt="" src="/img/posts/Juni/11_2/gambar10.png" /></p>

<p>juga melakukan inisialsasi topics, groupId  containerFactory.
Setlah program berhasil jalan dan tanpa eror selanjutnya melakukan deploytment ke server dengan melakukan build menggunakan maven.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mnv clean install package
$ java -jar name.jar
</code></pre></div></div>
<p>Setelah berhasil melakukan build maka dihasilkan filde jar yang akan di running</p>

<h2 id="4-program-postproducer">4. Program PostProducer</h2>
<p>Program ini juga masih menggunakan spring boot dan depedensi yang sama dari program sebelumya. Dalam program ini terdapat 4 package diantaranya :</p>

<ol>
  <li>controller, berisi java class bernama KreditControl yang berisi tentang perintah <code class="language-plaintext highlighter-rouge">@PostMapping</code> yang akan melakukan pengiriman pesan melalui HTTP Method melalu /post</li>
  <li>model,  berisi java class bernama kredit, hanya berisi inisialisi dari type pesan yang akan dikirimkan</li>
  <li>producerconfig, berisi java class yang mengatur konfigurasi Producer Kafka</li>
  <li>service, berisikan java class untuk melakukan @service terhadap topic yang akan memproduksi pesan</li>
</ol>

<p>pada <code class="language-plaintext highlighter-rouge">Kredit.java</code> berisi inisialisasi sebagai berikut</p>

<p><img title="Inisialiasi tipe data untuk topic" alt="" src="/img/posts/Juni/11_2/gambar11.png" /></p>

<p>pada <code class="language-plaintext highlighter-rouge">KreditControll.java</code> berisi perintah sebagai berikut.</p>

<p><img title="Melakukan Producer service" alt="" src="/img/posts/Juni/11_2/gambar12.png" /></p>

<p>pada KafkaProducerConfig dilakukan hal yang sama seperti sebelumnya ialah melakukan inisialisasi bootsrap server , key serta valuenya</p>

<p><img title="Melakukan Konfigurasi kafka" alt="" src="/img/posts/Juni/11_2/gambar13.png" /></p>

<p>IP Server yang menjalankan program ini yang akan IP yang menjalankan springboot pada port 8080, pengujian respon HTTP Method Post menggunakan postman.</p>

<p><img title="Pengujian Respon" alt="" src="/img/posts/Juni/11_2/gambar14.png" /></p>

<p>Setlah program berhasil jalan dan tanpa eror selanjutnya melakukan deploytment ke server dengan melakukan build menggunakan maven.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mnv clean install package	
$ java -jar name.jar
</code></pre></div></div>

<p>Setelah berhasil melakukan build maka dihasilkan filde jar yang akan di running</p>

<h2 id="5-program-postconsumer">5. Program PostConsumer</h2>

<p>Program ini juga masih menggunakan spring boot dan depedensi yang sama dari program sebelumya. Terdapat 3 Package diantaranya :</p>
<ol>
  <li>binding,  yang berisi StreamBinding.java berisi interface yang akan memisakan antara pesan kredit atau debit yang diterima oleh PostProducer</li>
  <li>Model, berisi java class bernama kredit, hanya berisi inisialisi dari type pesan yang akan dikirimkan</li>
  <li>Services, yang berisi StreamService.java akan melakukan Stream sesuai dengan pesan yang di bawa</li>
</ol>

<p>program binding
<img title=" Java binding" alt="" src="/img/posts/Juni/11_2/gambar15.png" /></p>
:ET